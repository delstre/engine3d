#pragma once

#include <GLFW/glfw3.h>

#include <map>
#include <functional>

namespace Engine {
    /**
     * Структура, описывающая функцию обратного вызова для клавиши или кнопки мыши.
     * Содержит состояние нажатия и саму функцию.
     */
    struct actfunc {
        bool pressed;   ///< Текущее состояние: была ли клавиша нажата в предыдущем кадре (используется для обработки нажатия/отпускания).
        bool action;    ///< true – вызывать функцию при нажатии (однократно), false – вызывать постоянно, пока клавиша удерживается.
        bool ismouse;   ///< true – событие мыши, false – событие клавиатуры.
        std::function<void()> func; ///< Функция, которая будет вызвана при срабатывании события.
    };

    /**
     * Класс для управления вводом с клавиатуры и мыши через GLFW.
     * Позволяет регистрировать обратные вызовы на нажатия клавиш и кнопок мыши
     * с возможностью выбора режима: однократное срабатывание или постоянное.
     */
    class WindowController {
        public:
            /**
             * Конструктор.
             * @param window Указатель на окно GLFW, для которого будет обрабатываться ввод.
             */
            WindowController(GLFWwindow* window);

            /**
             * Обрабатывает все зарегистрированные обратные вызовы.
             * Должен вызываться каждый кадр.
             * Проверяет состояние клавиш и кнопок мыши и вызывает соответствующие функции.
             */
            void ProcessInput();

            /**
             * Добавляет обратный вызов на клавишу клавиатуры.
             * @param key Код клавиши GLFW (например, GLFW_KEY_W).
             * @param ispressed Режим срабатывания: true – однократно при нажатии, false – постоянно при удержании.
             * @param func Функция, которая будет вызвана при срабатывании.
             */
            void AddCallback(int key, bool ispressed, std::function<void()> func);

            /**
             * Добавляет обратный вызов на кнопку мыши.
             * @param key Код кнопки мыши GLFW (например, GLFW_MOUSE_BUTTON_LEFT).
             * @param ispressed Режим срабатывания: true – однократно при нажатии, false – постоянно при удержании.
             * @param func Функция, которая будет вызвана при срабатывании.
             */
            void AddCallbackMouse(int key, bool ispressed, std::function<void()> func);

            /// Словарь зарегистрированных обратных вызовов (ключ – код клавиши/кнопки).
            std::map<int, actfunc> callbacks;
            /// Словарь состояний клавиш (ключ – код, значение – нажата ли в данный момент). (Не используется в текущей реализации)
            std::map<int, bool> keys;

        private:
            GLFWwindow* pWindow; ///< Указатель на окно GLFW.
    };
}
