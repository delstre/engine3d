#pragma once

#include <vector>
#include <string>
#include <mutex>

namespace Engine {
    /**
     * Глобальный вектор для хранения логов, полученных при выполнении команд.
     * Доступ к нему должен быть синхронизирован с помощью log_mutex.
     * Объявлен как static для создания отдельной копии в каждой единице трансляции,
     * что не рекомендуется; лучше использовать extern и определение в cpp-файле.
     */
    static std::vector<std::string> logs;

    /**
     * Мьютекс для синхронизации доступа к вектору logs.
     * Объявлен как static по той же причине, что и logs.
     */
    static std::mutex log_mutex;

    /**
     * Выполняет системную команду и захватывает её вывод (stdout и stderr).
     * Каждая строка вывода добавляется в глобальный вектор logs.
     * Доступ к logs защищается мьютексом log_mutex.
     * @param command Команда для выполнения в системной оболочке.
     * @throw std::runtime_error Если не удаётся открыть pipe (popen() failed).
     */
    void Execute(const std::string& command);

    /**
     * Возвращает копию всех накопленных логов.
     * Потокобезопасна благодаря блокировке log_mutex.
     * @return Вектор строк, содержащий все логи, собранные на данный момент.
     */
    std::vector<std::string> GetLogs();

    /**
     * Очищает вектор логов.
     * Потокобезопасна благодаря блокировке log_mutex.
     */
    void ClearLogs();
}
