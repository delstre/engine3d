#pragma once

#include <component.hpp>
#include <modelmanager.hpp>
#include <mesh.hpp>

namespace Renderer {
    class ShaderProgram;
    class Mesh;
}

namespace Engine {
    /**
     * Компонент Model представляет графическую модель объекта.
     * Содержит указатель на меш (Renderer::Mesh) и отвечает за его рендеринг.
     * Для корректной работы требует наличия компонента Transform на том же объекте.
     */
    class Model: public Engine::Component {
        public:
            /**
             * Конструктор по умолчанию. Инициализирует переменные класса через Init().
             */
            Model();

            /**
             * Деструктор по умолчанию.
             */
            ~Model() {};

            /**
             * Устанавливает меш, который будет отображаться.
             * @param mesh Указатель на объект Mesh.
             */
            void SetModel(Renderer::Mesh* mesh);

            /**
             * Устанавливает цвет модели (если меш поддерживает изменение цвета).
             * @param color Цвет в формате glm::vec3.
             */
            void SetColor(glm::vec3 color);

            /**
             * Возвращает указатель на текущий меш.
             * @return Указатель на Mesh или nullptr.
             */
            Renderer::Mesh *GetMesh();

            /**
             * Обновляет состояние компонента. Вызывает Render() меша,
             * передавая ему окружение (env) родительского объекта и матрицу трансформации.
             */
            void Update();

            /**
             * Метод для обновления интерфейса (редактор). По умолчанию ничего не делает.
             */
            void InterfaceUpdate();

            /**
             * Вызывается при активации компонента. Пустая реализация.
             */
            void Start();

            /**
             * Вызывается при деактивации компонента. Пустая реализация.
             */
            void End();

            /**
             * Возвращает позицию объекта, полученную из компонента Transform.
             * @return Вектор позиции, либо (0,0,0), если Transform отсутствует.
             */
            glm::vec3 GetPosition();

            /**
             * Возвращает матрицу модели, полученную из компонента Transform.
             * @return Матрица 4x4, либо единичная, если Transform отсутствует.
             */
            glm::mat4 GetMatrix();

            /**
             * Возвращает минимальные координаты ограничивающего параллелепипеда (AABB) модели
             * в мировых координатах (позиция объекта + смещение меша).
             * @return Вектор минимальных координат.
             */
            glm::vec3 GetMins();

            /**
             * Возвращает максимальные координаты ограничивающего параллелепипеда (AABB) модели
             * в мировых координатах.
             * @return Вектор максимальных координат.
             */
            glm::vec3 GetMaxs();

            // Макросы рефлексии
            DECLARE_CLASS_VARIABLE(Renderer::Mesh*, mesh, nullptr);

            // Регистрация переменных класса для рефлексии и сериализации
            DECLARE_CLASS_VARIABLES(
                REGISTER_CLASS_VARIABLE(Renderer::Mesh*, mesh);
            )
    };
}
