#pragma once

#include <fstream>

/**
 * Класс OArchive обеспечивает бинарную сериализацию в выходной поток (std::ofstream).
 * Поддерживает запись любых тривиальных типов через перегруженный оператор <<.
 */
class OArchive {
    public:
        /**
         * Конструктор. Принимает ссылку на открытый выходной файловый поток.
         * @param ofs Ссылка на std::ofstream, в который будут записываться данные.
         */
        OArchive(std::ofstream& ofs) : ofs_(ofs) {}

        /**
         * Шаблонный оператор для записи значения типа T в архив.
         * Работает для любых типов, для которых определена бинарная запись.
         * @tparam T Тип записываемого значения.
         * @param a Константная ссылка на записываемое значение.
         * @return Ссылка на текущий объект OArchive для цепочки вызовов.
         */
        template<typename T>
        OArchive& operator<<(const T& a);

        /**
         * Возвращает ссылку на внутренний выходной поток.
         * Используется для прямого доступа к std::ofstream при необходимости.
         * @return Ссылка на std::ofstream.
         */
        std::ofstream& get();

    private:
        std::ofstream& ofs_; ///< Ссылка на выходной файловый поток.
};

/**
 * Класс IArchive обеспечивает бинарную десериализацию из входного потока (std::ifstream).
 * Поддерживает чтение любых тривиальных типов через перегруженный оператор >>.
 */
class IArchive {
    public:
        /**
         * Конструктор. Принимает ссылку на открытый входной файловый поток.
         * @param ifs Ссылка на std::ifstream, из которого будут читаться данные.
         */
        IArchive(std::ifstream& ifs) : ifs_(ifs) {}

        /**
         * Шаблонный оператор для чтения значения типа T из архива.
         * Работает для любых типов, для которых определена бинарная запись.
         * @tparam T Тип читаемого значения.
         * @param a Ссылка на переменную, в которую будет прочитано значение.
         * @return Ссылка на текущий объект IArchive для цепочки вызовов.
         */
        template<typename T>
        IArchive& operator>>(T& a);

        /**
         * Возвращает ссылку на внутренний входной поток.
         * Используется для прямого доступа к std::ifstream при необходимости.
         * @return Ссылка на std::ifstream.
         */
        std::ifstream& get();

    private:
        std::ifstream& ifs_; ///< Ссылка на входной файловый поток.
};
